<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Interactive Plant Cell</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050a05; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: white; }
        canvas { display: block; }
        
        #ui-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            pointer-events: none;
        }

        .label-card {
            background: rgba(0, 40, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            backdrop-filter: blur(5px);
            margin-bottom: 10px;
            pointer-events: auto;
            max-width: 250px;
            transition: transform 0.2s;
        }

        .label-card:hover { transform: translateX(5px); }
        h1 { margin: 0 0 5px 0; font-size: 1.2rem; color: #a2f2a2; }
        p { margin: 0; font-size: 0.85rem; line-height: 1.4; opacity: 0.9; }

        #controls-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            pointer-events: none;
        }

        .legend {
            position: absolute;
            right: 20px;
            top: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        .legend-item { display: flex; align-items: center; margin-bottom: 5px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; }
    </style>
</head>
<body>

    <div id="ui-container">
        <div class="label-card">
            <h1>Plant Cell (Eukaryotic)</h1>
            <p>A high-quality 3D visualization of the structural and functional units of plant life.</p>
        </div>
        <div id="organelle-info" class="label-card" style="display:none;">
            <h1 id="part-name">Organelle</h1>
            <p id="part-desc">Hover over or click parts to explore.</p>
        </div>
    </div>

    <div class="legend">
        <div class="legend-item"><div class="dot" style="background:#2e7d32"></div>Cell Wall</div>
        <div class="legend-item"><div class="dot" style="background:#81c784"></div>Cytoplasm</div>
        <div class="legend-item"><div class="dot" style="background:#4fc3f7"></div>Vacuole</div>
        <div class="legend-item"><div class="dot" style="background:#f44336"></div>Nucleus</div>
        <div class="legend-item"><div class="dot" style="background:#2ecc71"></div>Chloroplast</div>
        <div class="legend-item"><div class="dot" style="background:#e67e22"></div>Mitochondria</div>
    </div>

    <div id="controls-hint">Drag to Rotate â€¢ Scroll to Zoom</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, cellGroup;
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let INTERSECTED;

        const infoBox = document.getElementById('organelle-info');
        const partName = document.getElementById('part-name');
        const partDesc = document.getElementById('part-desc');

        const descriptions = {
            'Cell Wall': 'Rigid outer layer made of cellulose that provides structural support and protection.',
            'Cytoplasm': 'Jelly-like substance (cytosol) filling the cell where organelles are suspended.',
            'Vacuole': 'Large central sac that stores water and maintains turgor pressure.',
            'Nucleus': 'The control center containing genetic material (DNA).',
            'Chloroplast': 'Site of photosynthesis, converting sunlight into chemical energy (glucose).',
            'Mitochondria': 'The powerhouse of the cell, generating ATP through cellular respiration.',
            'Endoplasmic Reticulum': 'Network of membranes involved in protein and lipid synthesis.'
        };

        function init() {
            // Scene setup
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 12;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xffffff, 0.8);
            pointLight.position.set(10, 10, 10);
            scene.add(pointLight);

            cellGroup = new THREE.Group();
            scene.add(cellGroup);

            createPlantCell();

            // Interactions
            window.addEventListener('resize', onWindowResize);
            document.addEventListener('mousemove', onMouseMove);
            
            // Basic rotation logic
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            document.addEventListener('mousedown', () => isDragging = true);
            document.addEventListener('mouseup', () => isDragging = false);
            document.addEventListener('mousemove', (e) => {
                if(isDragging) {
                    const deltaMove = {
                        x: e.offsetX - previousMousePosition.x,
                        y: e.offsetY - previousMousePosition.y
                    };
                    cellGroup.rotation.y += deltaMove.x * 0.01;
                    cellGroup.rotation.x += deltaMove.y * 0.01;
                }
                previousMousePosition = { x: e.offsetX, y: e.offsetY };
            });

            animate();
        }

        function createPlantCell() {
            // 1. Cell Wall (Semi-transparent Boxy Shape)
            const wallGeo = new THREE.BoxGeometry(8, 9, 6);
            const wallMat = new THREE.MeshPhongMaterial({
                color: 0x2e7d32,
                transparent: true,
                opacity: 0.15,
                side: THREE.BackSide
            });
            const cellWall = new THREE.Mesh(wallGeo, wallMat);
            cellWall.userData = { name: 'Cell Wall' };
            cellGroup.add(cellWall);

            // Outline for Cell Wall
            const edges = new THREE.EdgesGeometry(wallGeo);
            const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x4caf50, transparent: true, opacity: 0.5 }));
            cellGroup.add(line);

            // 2. Cytoplasm (Inner bulk)
            const cytoGeo = new THREE.BoxGeometry(7.5, 8.5, 5.5);
            const cytoMat = new THREE.MeshPhongMaterial({
                color: 0x81c784,
                transparent: true,
                opacity: 0.1
            });
            const cytoplasm = new THREE.Mesh(cytoGeo, cytoMat);
            cytoplasm.userData = { name: 'Cytoplasm' };
            cellGroup.add(cytoplasm);

            // 3. Central Vacuole (Large blue blob)
            const vacuoleGeo = new THREE.SphereGeometry(2.5, 32, 32);
            vacuoleGeo.scale(1, 1.4, 0.8);
            const vacuoleMat = new THREE.MeshPhongMaterial({ color: 0x4fc3f7, transparent: true, opacity: 0.6, shininess: 100 });
            const vacuole = new THREE.Mesh(vacuoleGeo, vacuoleMat);
            vacuole.position.set(0.5, 0, 0);
            vacuole.userData = { name: 'Vacuole' };
            cellGroup.add(vacuole);

            // 4. Nucleus (Purple sphere)
            const nucleusGroup = new THREE.Group();
            const nucGeo = new THREE.SphereGeometry(1, 32, 32);
            const nucMat = new THREE.MeshPhongMaterial({ color: 0xf44336 });
            const nucleus = new THREE.Mesh(nucGeo, nucMat);
            nucleus.userData = { name: 'Nucleus' };
            nucleusGroup.add(nucleus);

            const nucleolusGeo = new THREE.SphereGeometry(0.3, 16, 16);
            const nucleolusMat = new THREE.MeshPhongMaterial({ color: 0x311b92 });
            const nucleolus = new THREE.Mesh(nucleolusGeo, nucleolusMat);
            nucleolus.position.z = 0.5;
            nucleusGroup.add(nucleolus);

            nucleusGroup.position.set(-2, 2.5, 1.5);
            cellGroup.add(nucleusGroup);

            // 5. Chloroplasts
            const chloroGeo = new THREE.SphereGeometry(0.6, 20, 20);
            chloroGeo.scale(1, 0.4, 1.5);
            const chloroMat = new THREE.MeshPhongMaterial({ color: 0x2ecc71 });

            const positions = [[2.5, 3, 1.5], [-2.5, -3, 1], [2, -3, -1.5], [-2.5, 1, -2], [3, 0, 2]];
            positions.forEach(pos => {
                const cp = new THREE.Mesh(chloroGeo, chloroMat);
                cp.position.set(...pos);
                cp.rotation.set(Math.random(), Math.random(), Math.random());
                cp.userData = { name: 'Chloroplast' };
                cellGroup.add(cp);
            });

            // 6. Mitochondria (Custom Capsule for r128 compatibility)
            const mitoMat = new THREE.MeshPhongMaterial({ color: 0xe67e22 });
            const mitoPositions = [[-1, -3, 2], [2, 3, -1], [-3, -1, -1.5], [1, 1, -2]];

            mitoPositions.forEach(pos => {
                const mitoGroup = new THREE.Group();
                
                const bodyGeo = new THREE.CylinderGeometry(0.25, 0.25, 0.6, 12);
                const body = new THREE.Mesh(bodyGeo, mitoMat);
                
                const capGeo = new THREE.SphereGeometry(0.25, 12, 12);
                const capTop = new THREE.Mesh(capGeo, mitoMat);
                capTop.position.y = 0.3;
                const capBottom = new THREE.Mesh(capGeo, mitoMat);
                capBottom.position.y = -0.3;
                
                mitoGroup.add(body, capTop, capBottom);
                mitoGroup.position.set(...pos);
                mitoGroup.rotation.set(Math.random(), Math.random(), Math.random());
                
                // Assign metadata to children for raycasting
                mitoGroup.children.forEach(c => c.userData = { name: 'Mitochondria' });
                cellGroup.add(mitoGroup);
            });

            // 7. Endoplasmic Reticulum
            const erMat = new THREE.MeshPhongMaterial({ color: 0xe91e63, side: THREE.DoubleSide, transparent: true, opacity: 0.8 });
            for(let i=0; i<3; i++) {
                const erGeo = new THREE.TorusGeometry(1.5 + (i*0.3), 0.1, 8, 50, Math.PI);
                const er = new THREE.Mesh(erGeo, erMat);
                er.position.set(-2, 2.5, 1.5);
                er.rotation.x = Math.PI/2 + (i*0.2);
                er.userData = { name: 'Endoplasmic Reticulum' };
                cellGroup.add(er);
            }
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            cellGroup.rotation.y += 0.002;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(cellGroup.children, true);

            if (intersects.length > 0) {
                const obj = intersects[0].object;
                const name = obj.userData.name || (obj.parent && obj.parent.userData.name);
                
                if (name && descriptions[name]) {
                    infoBox.style.display = 'block';
                    partName.innerText = name;
                    partDesc.innerText = descriptions[name];
                    
                    if (INTERSECTED != obj) {
                        if (INTERSECTED && INTERSECTED.material && INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x000000);
                        INTERSECTED = obj;
                        if (INTERSECTED.material && INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x333333);
                    }
                }
            } else {
                if (INTERSECTED && INTERSECTED.material && INTERSECTED.material.emissive) INTERSECTED.material.emissive.setHex(0x000000);
                INTERSECTED = null;
                infoBox.style.display = 'none';
            }

            renderer.render(scene, camera);
        }

        window.onload = init;
    </script>
</body>
</html>

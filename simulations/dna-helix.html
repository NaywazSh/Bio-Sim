<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive DNA Simulation</title>
    <style>
        :root {
            --accent: #00d2ff;
        }
        body { margin: 0; overflow: hidden; background-color: #050508; color: white; font-family: 'Segoe UI', Tahoma, sans-serif; }
        
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            pointer-events: none;
        }

        .glass-panel {
            background: rgba(15, 15, 25, 0.7);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--accent);
            pointer-events: auto;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        h1 { margin: 0; font-size: 1.2rem; color: var(--accent); letter-spacing: 1px; }
        p { font-size: 0.85rem; line-height: 1.5; opacity: 0.8; margin: 10px 0; }

        #controls-panel {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 320px;
            text-align: center;
        }

        .slider-box {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 25px;
            border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.1);
            pointer-events: auto;
        }

        input[type=range] {
            width: 100%;
            cursor: pointer;
            accent-color: var(--accent);
        }

        #data-display {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
            font-family: monospace;
            color: var(--accent);
            font-size: 0.75rem;
            pointer-events: none;
        }

        .legend {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
            font-size: 0.7rem;
        }
        .color-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 4px; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="glass-panel">
            <h1>DNA Structure</h1>
            <p>The double helix consists of two antiparallel strands made of sugar-phosphates, connected by nitrogenous base pairs.</p>
            <div id="info-box" style="color: #00d2ff; font-weight: bold; min-height: 1.2em;">
                Hover over a base pair to identify
            </div>
            <div class="legend">
                <span><div class="color-dot" style="background:#ff4444"></div>Adenine</span>
                <span><div class="color-dot" style="background:#4444ff"></div>Thymine</span>
            </div>
            <div class="legend">
                <span><div class="color-dot" style="background:#ffff44"></div>Guanine</span>
                <span><div class="color-dot" style="background:#44ff44"></div>Cytosine</span>
            </div>
        </div>
    </div>

    <div id="data-display">
        HELI-SCAN v2.0<br>
        B-FORM CONFIGURATION<br>
        STABILITY: <span id="stability">100%</span>
    </div>

    <div id="controls-panel">
        <div class="slider-box">
            <label style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px;">Torsional Twist</label>
            <input type="range" id="twistSlider" min="0" max="8" step="0.01" value="2.5">
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, dnaGroup, raycaster, mouse, rimLight;
        const count = 36; 
        const basePairs = [];

        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050508, 0.03);

            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(20, 5, 25);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // --- LIGHTING FIX ---
            // High-intensity Ambient Light for base visibility
            const amb = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(amb);
            
            // Key Light (White)
            const p1 = new THREE.PointLight(0xffffff, 2);
            p1.position.set(20, 20, 20);
            scene.add(p1);

            // Rim Light (Cyan/Accent) - Positioned to catch edges
            rimLight = new THREE.PointLight(0x00d2ff, 1.5);
            rimLight.position.set(-15, -10, 15);
            scene.add(rimLight);

            // Back Light (Warm)
            const p2 = new THREE.PointLight(0xffaa44, 0.8);
            p2.position.set(-10, 10, -20);
            scene.add(p2);

            dnaGroup = new THREE.Group();
            scene.add(dnaGroup);

            setupDNA();
            animate();

            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);
        }

        function setupDNA() {
            const sphereGeo = new THREE.SphereGeometry(0.5, 24, 24);
            const connectorGeo = new THREE.CylinderGeometry(0.12, 0.12, 1, 8);

            // Enhanced materials with Emissive properties for a "glow"
            const createBaseMat = (color) => new THREE.MeshPhongMaterial({ 
                color: color, 
                shininess: 100, 
                emissive: color, 
                emissiveIntensity: 0.15 
            });

            const mats = {
                A: createBaseMat(0xff4444),
                T: createBaseMat(0x4444ff),
                G: createBaseMat(0xffff44),
                C: createBaseMat(0x44ff44),
                Bond: new THREE.MeshPhongMaterial({ 
                    color: 0xffffff, 
                    transparent: true, 
                    opacity: 0.25,
                    shininess: 120 
                })
            };

            const pairs = [['A', 'T'], ['G', 'C'], ['T', 'A'], ['C', 'G']];

            for (let i = -count/2; i < count/2; i++) {
                const pairType = pairs[Math.abs(i) % 4];
                const group = new THREE.Group();

                // Side 1
                const b1 = new THREE.Mesh(sphereGeo, mats[pairType[0]]);
                b1.position.x = 4;
                b1.userData = { name: pairType[0] === 'A' ? 'Adenine' : (pairType[0] === 'T' ? 'Thymine' : (pairType[0] === 'G' ? 'Guanine' : 'Cytosine')) };

                // Side 2
                const b2 = new THREE.Mesh(sphereGeo, mats[pairType[1]]);
                b2.position.x = -4;
                b2.userData = { name: pairType[1] === 'A' ? 'Adenine' : (pairType[1] === 'T' ? 'Thymine' : (pairType[1] === 'G' ? 'Guanine' : 'Cytosine')) };

                // Hydrogen Bonds (Connectors)
                const bond = new THREE.Mesh(connectorGeo, mats.Bond);
                bond.scale.y = 8;
                bond.rotation.z = Math.PI / 2;

                group.add(b1, b2, bond);
                group.position.y = i * 1.2;
                
                dnaGroup.add(group);
                basePairs.push({ group, offset: i });
            }
        }

        function updateTwist(val) {
            basePairs.forEach(bp => {
                bp.group.rotation.y = bp.offset * val * 0.15;
            });
            
            const stability = Math.max(0, 100 - Math.abs(2.5 - val) * 20);
            const stabilityEl = document.getElementById('stability');
            stabilityEl.innerText = stability.toFixed(0) + "%";
            stabilityEl.style.color = stability < 50 ? "#ff3131" : "#00f3ff";
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            const twist = document.getElementById('twistSlider').value;
            updateTwist(twist);

            dnaGroup.rotation.y += 0.005;

            // Make the rim light subtly orbit to keep lighting dynamic
            const time = Date.now() * 0.001;
            rimLight.position.x = Math.sin(time) * 15;
            rimLight.position.z = Math.cos(time) * 15;

            // Raycasting for interaction
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(dnaGroup.children, true);
            const infoBox = document.getElementById('info-box');

            if (intersects.length > 0) {
                const target = intersects[0].object;
                if (target.userData.name) {
                    infoBox.innerText = "Current Segment: " + target.userData.name;
                    infoBox.style.color = target.material.color.getStyle();
                    // Temporary Highlight on hover
                    target.material.emissiveIntensity = 0.8;
                }
            } else {
                infoBox.innerText = "Hover over a base pair to identify";
                infoBox.style.color = "var(--accent)";
                // Reset intensities
                basePairs.forEach(bp => {
                    bp.group.children[0].material.emissiveIntensity = 0.15;
                    bp.group.children[1].material.emissiveIntensity = 0.15;
                });
            }

            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>
